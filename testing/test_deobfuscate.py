import pytest
from deobfuscate import deobfuscate


@pytest.mark.parametrize(('unparsed', 'expected'), (
    ('1;2', ['1;', '2']),
    ('1', ['1']),
    (';1', [';', '1']),
    ('1;2;3', ['1;', '2;', '3']),
    ('1;2;3;', ['1;', '2;', '3;']),
    ([], None),
    (['1'], ['1']),
    ([['1;2'], '3'], ['1;', '2', '3']),
    ([['1;2;'], '3;'], ['1;', '2;', '3;']),
    ([['1;2;', ['1', '2', '3']], '3;'], ['1;', '2;', '1', '2', '3', '3;']),
    ([[[]], [], [[[]]], []], []),
    (';;;', [';', ';', ';']),
    ([';'], [';']),
    ))
def test_recur_split(unparsed, expected):
    assert deobfuscate.recur_split(unparsed, ';') == expected


@pytest.mark.parametrize(('unparsed', 'expected'), (
    (';1', [';', '1']),
    ('1,2;3', ['1,2;', '3']),
    ('1;2;3', ['1;', '2;', '3']),
    ('1;2;3;', ['1;', '2;', '3;']),
    (['1'], ['1']),
    (['1;'], ['1;']),
    (';;;', [';', ';', ';']),
    ([';'], [';']),
    ([], None),
    ('1;', ['1;']),
    (['1;2', ['1;2;3']], ['1;', '2', '1;', '2;', '3']),
    ([['1;2;'], '3;'], ['1;', '2;', '3;']),
    ([['1;2;', ['1', '2', '3']], '3;'], ['1;', '2;', '1', '2', '3', '3;']),
    ))
def test_generate_linebreaks_no_delim(unparsed, expected):
    assert deobfuscate.generate_linebreaks(unparsed) == expected


@pytest.mark.parametrize(('unparsed', 'delims', 'expected'), (
    ('1,2;3', [';', ','], ['1,', '2;', '3']),
    (['1'], [';', ','], ['1']),
    ([], [';', ','], None),
    ([';1,2;3,'], [';', ','], [';', '1,', '2;', '3,']),
    (['2;3,1,2;3,'], [';', ','], ['2;', '3,', '1,', '2;', '3,']),
    ([['2;3,1,2;3,'], ',1;2,'], [';', ','], ['2;', '3,', '1,', '2;', '3,', ',', '1;', '2,']),
    (';,;,;,', [';', ','], [';', ',', ';', ',', ';', ',']),
    ([[';,'], ';', [',', [';,']]], [';', ','], [';', ',', ';', ',', ';', ',']),
    (['123,1;:2:3', ';', '::', ['1', ',2']], [';', ':', ','],
     ['123,', '1;', ':', '2:', '3', ';', ':', ':', '1', ',', '2'])
    ))
def test_generate_linebreaks_delims(unparsed, delims, expected):
    assert deobfuscate.generate_linebreaks(unparsed, *delims) == expected
